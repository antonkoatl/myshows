{% extends "base.html" %}

{% block content %}
    {% csrf_token %}
    <div class="col" style="width: 700px; height: 400px">
        <img src="{{ question.image.url }}" class="img-fluid" alt="..." style="height: 100%; width: 100%; object-fit: contain">
        <ul id="simpleList" class="list-group list-group-horizontal">
            <li class="list-group-item list-group-item-action" id="answer0">{{ question.variants.0 }}</li>
            <li class="list-group-item list-group-item-action" id="answer1">{{ question.variants.1 }}</li>
            <li class="list-group-item list-group-item-action" id="answer2">{{ question.variants.2 }}</li>
            <li class="list-group-item list-group-item-action" id="answer3">{{ question.variants.3 }}</li>
        </ul>
    </div>
    <script>
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    function checkAnswer() {
        $('#simpleList').off();
        $.ajax({
            method: "POST",
            url: "{% url 'check_trivia' %}",
            headers: {'X-CSRFToken': csrftoken},
            data: {
                answer: $(this).text(),
            },
            context: this,
            success: function(response) {
                if (response['result']) {
                    $(this).addClass('list-group-item-success');
                } else {
                    $(this).addClass('list-group-item-danger');
                    $('#answer' + response['correct_answer']).addClass('list-group-item-success');
                }
                setTimeout(function(){ location.reload(); }, 1000);
            },
            error: function(e) {
                alert("Error: " + e);
            }
        });
    }

    $("#simpleList").on('click', 'li', checkAnswer);
</script>
{% endblock %}

{% block sidebar %}
    <h4>Счёт: <span class="badge bg-danger">{{ score }}</span></h4>
    <h4>Режим</h4>
    <div class="list-group">
        <a href="{% url 'trivia' %}?mode=all" class="list-group-item list-group-item-action{% if mode == 'all' %} active{% endif %}" aria-current="true">Все</a>
        <a href="{% url 'trivia' %}?mode=shows" class="list-group-item list-group-item-action{% if mode == 'shows' %} active{% endif %}" aria-current="true">Сериалы</a>
        <a href="{% url 'trivia' %}?mode=cartoon" class="list-group-item list-group-item-action{% if mode == 'cartoon' %} active{% endif %}" aria-current="true">Мультфильмы</a>
        <a href="{% url 'trivia' %}?mode=anime" class="list-group-item list-group-item-action{% if mode == 'anime' %} active{% endif %}" aria-current="true">Аниме</a>
        <a href="{% url 'trivia' %}?mode=russia" class="list-group-item list-group-item-action{% if mode == 'russia' %} active{% endif %}" aria-current="true">Россия</a>
        <a href="{% url 'trivia' %}?mode=america" class="list-group-item list-group-item-action{% if mode == 'america' %} active{% endif %}" aria-current="true">Америка</a>
    </div>
{% endblock %}